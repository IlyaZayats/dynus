# Сервис динамического сегментирования пользователей
### Информация по Docker:
Файл *compose.yaml* содержит инструкции по контейнерам dynus и postgres. Dockerfile контейнера dynus расположен в корневой папке проекта, а для postgres в *build/postgres*.   

### Требования к входным данным:
- Названия сегментов могут содержать только заглавные и прописные латинские буквы, цифры, а так же нижнее подчёркивание;
- Процент пользователей, которые попадут в сегмент при его инициализации, должен быть указан в формате float и в диапазоне от 0 до 1 (∈[0;1]);
- Id пользователя - целое положительное;
- Месяц, по которому требуется получить сводку об обновленных записях, должен быть в формате "YYYY-MM";
- Ttl - строкой в формате временного интервала ("1 year", "1 month" и тд.)
> В противном случае будет получен ответ 400 от сервера с указанием ошибки валидации!

### CURL HTTP запросы к API:

- Создание сегмента:
`curl -XPUT -H"Content-Type: application/json" localhost:8090/slugs \-d `\
`'{`\
$~~~~~~~~$`"name": "<ИМЯ_СЕГМЕНТА>",`\
$~~~~~~~~$` "chance": "<ПРОЦЕНТ_ПОЛЬЗОВАТЕЛЕЙ_КОТОРЫЕ_БУДУТ_ДОБАВЛЕНЫ_АВТОМАТИЧЕСКИ>"`\
`}'`
- Удаление сегмента:
`curl -XDELETE -H"Content-Type: application/json" localhost:8090/slugs \-d `\
`'{`\
$~~~~~~~~$`"name": "<ИМЯ_СЕГМЕНТА>"`\
`}'`\
- Получение сегментов пользователя:
`curl -XGET -H"Content-Type: application/json" localhost:8090/slugs/<ID_ПОЛЬЗОВАТЕЛЯ>`

- Получение месячной сводки:
`curl -XGET -H"Content-Type: application/json" localhost:8090/slugs/history/<ГОД>-<МЕСЯЦ>`

- Добавление пользователя в сегменты, а так же ttl:
`curl -XPOST -H"Content-Type: application/json" localhost:8090/slugs/<ID_ПОЛЬЗОВАТЕЛЯ> -d\ `\
`'{`\
$~~~~~~~~$`"insert_slugs": [<НАЗВАНИЯ_СЕГЕМЕНТОВ_К_ДОБАЛЕНИЮ>, "..."], `\
$~~~~~~~~$`"delete_slugs": ["<НАЗВАНИЯ_СЕГЕМЕНТОВ_К_УДАЛЕНИЮ>", "..."], `\
$~~~~~~~~$`"ttl": {`\
$~~~~~~~~$$~~~~~~~~$`"<ИМЕНА_СЕГМЕНТОВ_С_TTL>" : "<ЗНАЧЕНИЕ_ИНТЕРВАЛА>",`\
$~~~~~~~~$$~~~~~~~~$`"..." : "..."`
$~~~~~~~~$`}`\
`}'`

